VERSION 0.8

IMPORT ../../../ AS catalyst-voices
IMPORT github.com/input-output-hk/catalyst-ci/earthly/flutter:v3.5.20 AS flutter-ci
IMPORT github.com/input-output-hk/catalyst-ci/earthly/flutter_rust_bridge:v3.5.20 AS flutter_rust_bridge

builder:
    FROM flutter_rust_bridge+builder
    COPY catalyst-voices+repo-catalyst-voices/repo .
    WORKDIR packages/libs/catalyst_key_derivation

# Generated necessary files for running Flutter web locally and save it locally.
code-generator:
    FROM +builder
    DO flutter_rust_bridge+CODE_GENERATOR_WEB --WASM_MODULE_NAME="key_derivation_wasm_bindgen"

    ARG local = false
    IF [ $local = true ]
        SAVE ARTIFACT ./assets/js AS LOCAL ./assets/js
        SAVE ARTIFACT ./rust/src/frb_generated.rs AS LOCAL ./rust/src/frb_generated.rs
        SAVE ARTIFACT ./lib/src AS LOCAL ./lib/src
    ELSE
        SAVE ARTIFACT ./assets/js assets_js
        SAVE ARTIFACT ./rust/src/frb_generated.rs frb_generated.rs
        SAVE ARTIFACT ./lib/src src
    END