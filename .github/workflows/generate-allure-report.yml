name: Allure Report Generation

on:
  push:

permissions:
    id-token: write
    contents: write
    packages: write

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

env:
    AWS_REGION: eu-central-1
    AWS_ROLE_ARN: arn:aws:iam::332405224602:role/ci
    EARTHLY_TARGET: docker
    ECR_REGISTRY: 332405224602.dkr.ecr.eu-central-1.amazonaws.com

jobs:
  generate-allure-report:
    name: Generate allure report
    runs-on: ubuntu-latest
    steps:
      - name: Get unit test report
        uses: input-output-hk/catalyst-ci/actions/run@master
        id: build
        with:
            earthfile: .
            flags:
            targets: build
            target_flags:
            runner_address: ${{ secrets.EARTHLY_SATELLITE_ADDRESS }}
            artifact: "true"